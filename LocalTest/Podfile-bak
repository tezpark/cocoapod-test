source 'https://cdn.cocoapods.org/'

platform :ios, '15.0'
use_frameworks!
inhibit_all_warnings!

target 'QuickStart' do
  
  pod 'SendbirdNetworkImage', :path => '../repo/sendbird-cocoapods/Sources/NetworkImage'
  pod 'SendbirdSplash', :path => '../repo/sendbird-cocoapods/Sources/Splash'  
  pod 'SendbirdMarkdownUI', :path => '../repo/sendbird-cocoapods/Sources/MarkdownUI'
  pod 'SendbirdAIAgentCore', :path => '../repo/sendbird-cocoapods/Sources/SendbirdAIAgentCore'
  pod 'SendbirdAIAgentMessenger', :path => '../repo/sendbird-cocoapods/Sources/SendbirdAIAgentMessenger'
  pod 'SendbirdUIMessageTemplate', '~> 3.30'
  
end

post_install do |installer|
  # 🎯 가장 강력한 해결책: 모든 빌드 설정을 강제로 통일
  
  # 1. 모든 타겟의 빌드 설정 통일
  installer.pods_project.targets.each do |target|
    puts "🔧 Configuring target: #{target.name}"
    
    target.build_configurations.each do |config|
      puts "  📝 Config: #{config.name}"
      
      # 기본 설정
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.0'
      config.build_settings['GCC_WARN_INHIBIT_ALL_WARNINGS'] = 'YES'
      config.build_settings['CLANG_WARN_DOCUMENTATION_COMMENTS'] = 'NO'
      
      # 🔥 핵심: BUILD_LIBRARY_FOR_DISTRIBUTION 완전 제거 후 재설정
      config.build_settings.delete('BUILD_LIBRARY_FOR_DISTRIBUTION')
      config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'NO'
      
      # 일관성을 위한 추가 설정
      config.build_settings['ENABLE_BITCODE'] = 'NO'
      config.build_settings['SWIFT_COMPILATION_MODE'] = 'wholemodule'
      config.build_settings['DEFINES_MODULE'] = 'YES'
      config.build_settings['ONLY_ACTIVE_ARCH'] = 'YES' if config.name == 'Debug'
    end
  end
  
  # 2. 프로젝트 레벨 설정
  installer.pods_project.build_configurations.each do |config|
    config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'NO'
  end
  
  # 3. 집계 타겟 설정
  installer.generated_aggregate_targets.each do |aggregate_target|
    aggregate_target.xcconfigs.each do |config_name, config_file|
      config_file.other_linker_flags[:simple] << ' -ObjC' if config_file.other_linker_flags[:simple]
    end
  end
  
  puts "✅ All build settings unified successfully!"
end